<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo一覧 - Todo管理システム</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <nav class="navbar">
        <h1>Todo管理システム</h1>
        <ul>
            <li><a th:href="@{/todos}" class="active">一覧</a></li>
            <li><a th:href="@{/todos/new}">新規作成</a></li>
            <li><a th:href="@{/todos/search}">検索</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Flash Messages -->
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
        <div th:if="${warningMessage}" class="alert alert-warning" th:text="${warningMessage}"></div>
        <div th:if="${infoMessage}" class="alert alert-info" th:text="${infoMessage}"></div>

        <h1>Todo一覧</h1>

        <!-- 統計情報 -->
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
            <div class="card" style="flex: 1; margin-right: 10px;">
                <div class="card-header">
                    <h5>未完了</h5>
                </div>
                <div class="card-body">
                    <h3 th:text="${todoCount}" style="color: #dc3545;">0</h3>
                </div>
            </div>
            <div class="card" style="flex: 1; margin: 0 10px;">
                <div class="card-header">
                    <h5>進行中</h5>
                </div>
                <div class="card-body">
                    <h3 th:text="${inProgressCount}" style="color: #ffc107;">0</h3>
                </div>
            </div>
            <div class="card" style="flex: 1; margin-left: 10px;">
                <div class="card-header">
                    <h5>完了</h5>
                </div>
                <div class="card-body">
                    <h3 th:text="${doneCount}" style="color: #28a745;">0</h3>
                </div>
            </div>
        </div>

        <!-- アクションボタン -->
        <div style="margin-bottom: 20px;">
            <a th:href="@{/todos/new}" class="btn btn-primary">新しいTodoを作成</a>
            <a th:href="@{/todos/search}" class="btn btn-secondary">検索</a>
        </div>

        <!-- Todo一覧テーブル -->
        <div th:if="${todos.hasContent()}">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>タイトル</th>
                        <th>ステータス</th>
                        <th>優先度</th>
                        <th>期限</th>
                        <th>作成日</th>
                        <th>アクション</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="todo : ${todos.content}">
                        <td th:text="${todo.id}">1</td>
                        <td>
                            <a th:href="@{/todos/{id}(id=${todo.id})}" th:text="${todo.title}">Sample Todo</a>
                        </td>
                        <td>
                            <span th:text="${todo.status.displayName}" 
                                  th:class="|badge ${todo.status.name() == 'TODO'} ? 'badge-danger' : 
                                           (${todo.status.name() == 'IN_PROGRESS'} ? 'badge-warning' : 'badge-success')|">
                                未完了
                            </span>
                        </td>
                        <td>
                            <span th:text="${todo.priority.displayName}" 
                                  th:class="|badge ${todo.priority.name() == 'HIGH'} ? 'badge-danger' : 
                                           (${todo.priority.name() == 'MEDIUM'} ? 'badge-warning' : 'badge-secondary')|">
                                中
                            </span>
                        </td>
                        <td th:text="${todo.dueDate != null} ? ${#temporals.format(todo.dueDate, 'yyyy-MM-dd')} : '-'">2024-01-01</td>
                        <td th:text="${#temporals.format(todo.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</td>
                        <td>
                            <a th:href="@{/todos/{id}(id=${todo.id})}" class="btn btn-primary" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">詳細</a>
                            <a th:href="@{/todos/{id}/edit(id=${todo.id})}" class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">編集</a>
                            <form th:action="@{/todos/{id}/delete(id=${todo.id})}" method="post" style="display: inline;" onsubmit="return confirm('本当に削除しますか？');">
                                <button type="submit" class="btn btn-danger" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">削除</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- ページング -->
            <nav th:if="${todos.totalPages > 1}" aria-label="Page navigation">
                <ul class="pagination">
                    <li class="page-item" th:class="${todos.first} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/todos(page=${todos.number - 1}, size=${todos.size})}">前へ</a>
                    </li>
                    
                    <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, todos.totalPages - 1)}"
                        th:class="${pageNum == todos.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/todos(page=${pageNum}, size=${todos.size})}" th:text="${pageNum + 1}">1</a>
                    </li>
                    
                    <li class="page-item" th:class="${todos.last} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/todos(page=${todos.number + 1}, size=${todos.size})}">次へ</a>
                    </li>
                </ul>
            </nav>

            <!-- ページング情報 -->
            <p style="margin-top: 10px; color: #6c757d;">
                全 <span th:text="${todos.totalElements}">0</span> 件中 
                <span th:text="${todos.number * todos.size + 1}">1</span> - 
                <span th:text="${todos.number * todos.size + todos.numberOfElements}">10</span> 件を表示
                （<span th:text="${todos.number + 1}">1</span> / <span th:text="${todos.totalPages}">1</span> ページ）
            </p>
        </div>

        <!-- データなし -->
        <div th:unless="${todos.hasContent()}" class="card">
            <div class="card-body" style="text-align: center; padding: 3rem;">
                <h3 style="color: #6c757d;">Todoがありません</h3>
                <p style="color: #6c757d;">まずは新しいTodoを作成してみましょう。</p>
                <a th:href="@{/todos/new}" class="btn btn-primary">新しいTodoを作成</a>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Todo管理システム. All rights reserved.</p>
    </footer>

    <style>
        .badge {
            padding: 0.25em 0.6em;
            font-size: 75%;
            font-weight: bold;
            border-radius: 0.25rem;
            color: white;
        }
        .badge-danger { background-color: #dc3545; }
        .badge-warning { background-color: #ffc107; color: #212529; }
        .badge-success { background-color: #28a745; }
        .badge-secondary { background-color: #6c757d; }
        
        .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }
        
        .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
        }
    </style>
</body>
</html>