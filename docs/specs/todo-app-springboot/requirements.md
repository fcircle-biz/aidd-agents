# 要件文書

## 概要

Spring Bootフレームワークを使用したシンプルなTodo管理アプリケーションです。H2組み込みデータベースを採用し、RESTful APIとWebインターフェースを通じて、タスクの効率的な管理機能を提供します。

## 要件

### 要件 1: Todo作成機能

**ユーザーストーリー:** エンドユーザーとして、新しいTodoタスクを作成したいので、自分のタスクを記録・管理できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーがタイトルと説明を入力してTodo作成フォームを送信する THEN 新しいTodoがデータベースに保存される SHALL
2. WHEN タイトルが空の状態でフォームを送信する THEN "タイトルは必須項目です"というエラーメッセージが表示される SHALL
3. IF タイトルが100文字を超える場合 THEN "タイトルは100文字以内で入力してください"というバリデーションエラーが表示される SHALL
4. WHEN Todoが正常に作成される THEN "Todoを作成しました"という確認メッセージが表示され、一覧画面に遷移する SHALL

### 要件 2: Todo一覧表示機能

**ユーザーストーリー:** エンドユーザーとして、すべてのTodoタスクを一覧で確認したいので、タスクの全体像を把握できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面にアクセスする THEN データベースに保存されているすべてのTodoがテーブル形式で表示される SHALL
2. WHEN 一覧に表示される各Todoアイテム THEN ID、タイトル、説明、ステータス、作成日時、更新日時が表示される SHALL
3. IF データベースにTodoが存在しない場合 THEN "登録されているTodoはありません"というメッセージが表示される SHALL
4. WHEN 一覧画面が表示される THEN 作成日時の降順（新しいものが上）でソートされる SHALL

### 要件 3: Todo詳細表示機能

**ユーザーストーリー:** エンドユーザーとして、特定のTodoの詳細情報を確認したいので、タスクの完全な情報を把握できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面からTodoアイテムをクリックする THEN 該当Todoの詳細画面が表示される SHALL
2. WHEN 詳細画面が表示される THEN すべてのフィールド（ID、タイトル、説明、ステータス、優先度、期限、作成日時、更新日時）が表示される SHALL
3. IF 存在しないIDでアクセスした場合 THEN 404エラーページが表示され、"指定されたTodoが見つかりません"というメッセージが表示される SHALL
4. WHEN 詳細画面が表示される THEN 編集ボタンと削除ボタンが表示される SHALL

### 要件 4: Todo編集機能

**ユーザーストーリー:** エンドユーザーとして、既存のTodoタスクを編集したいので、タスクの情報を最新の状態に保てるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが編集フォームで情報を変更して保存する THEN データベースのTodo情報が更新される SHALL
2. WHEN タイトルを空にして保存しようとする THEN "タイトルは必須項目です"というエラーメッセージが表示される SHALL
3. IF ステータスを変更する場合 THEN "未完了"、"進行中"、"完了"の3つから選択できる SHALL
4. WHEN 更新が成功する THEN "Todoを更新しました"という確認メッセージが表示され、詳細画面に戻る SHALL
5. WHEN 更新される THEN 更新日時が現在時刻に自動的に更新される SHALL

### 要件 5: Todo削除機能

**ユーザーストーリー:** エンドユーザーとして、不要になったTodoタスクを削除したいので、タスクリストを整理できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが削除ボタンをクリックする THEN "本当に削除しますか？"という確認ダイアログが表示される SHALL
2. WHEN 確認ダイアログで"はい"を選択する THEN Todoがデータベースから物理削除される SHALL
3. IF 削除対象のTodoが存在しない場合 THEN "指定されたTodoが見つかりません"というエラーメッセージが表示される SHALL
4. WHEN 削除が成功する THEN "Todoを削除しました"という確認メッセージが表示され、一覧画面に遷移する SHALL

### 要件 6: Todo検索機能

**ユーザーストーリー:** エンドユーザーとして、特定のTodoタスクを検索したいので、必要なタスクを素早く見つけられるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが検索キーワードを入力して検索ボタンをクリックする THEN タイトルまたは説明に該当キーワードを含むTodoが表示される SHALL
2. WHEN ステータスフィルターを選択する THEN 選択したステータスのTodoのみが表示される SHALL
3. IF 検索結果が0件の場合 THEN "検索条件に一致するTodoが見つかりません"というメッセージが表示される SHALL
4. WHEN 検索フィルターをクリアする THEN すべてのTodoが再表示される SHALL

### 要件 7: RESTful API提供

**ユーザーストーリー:** 外部システム開発者として、APIを通じてTodo操作を行いたいので、システム間連携ができるようになりたい

#### 受け入れ基準

1. WHEN GET /api/todos にアクセスする THEN JSON形式ですべてのTodo一覧が返される SHALL
2. WHEN POST /api/todos にJSONデータを送信する THEN 新しいTodoが作成され、201ステータスコードが返される SHALL
3. WHEN PUT /api/todos/{id} にJSONデータを送信する THEN 指定IDのTodoが更新され、200ステータスコードが返される SHALL
4. WHEN DELETE /api/todos/{id} にリクエストを送信する THEN 指定IDのTodoが削除され、204ステータスコードが返される SHALL
5. IF 不正なJSONフォーマットが送信された場合 THEN 400 Bad Requestエラーが返される SHALL

### 要件 8: データ永続化

**ユーザーストーリー:** システム管理者として、Todoデータを永続的に保存したいので、システム再起動後もデータが維持されるようになりたい

#### 受け入れ基準

1. WHEN アプリケーションが起動する THEN H2組み込みデータベースが自動的に初期化される SHALL
2. WHEN Todoエンティティが保存される THEN JPA（Spring Data JPA）を使用してデータベースに永続化される SHALL
3. IF データベース接続エラーが発生した場合 THEN エラーログが記録され、適切なエラーメッセージがユーザーに表示される SHALL
4. WHEN アプリケーションが本番環境で実行される THEN H2データベースのファイルモードでデータが永続化される SHALL

### 要件 9: エラーハンドリング

**ユーザーストーリー:** エンドユーザーとして、エラーが発生した際に適切なフィードバックを受け取りたいので、問題を理解し対処できるようになりたい

#### 受け入れ基準

1. WHEN データベース操作でエラーが発生する THEN ユーザーに分かりやすいエラーメッセージが表示される SHALL
2. WHEN 404エラーが発生する THEN カスタム404エラーページが表示される SHALL
3. WHEN 500エラーが発生する THEN カスタム500エラーページが表示され、エラー詳細がログに記録される SHALL
4. WHEN バリデーションエラーが発生する THEN 該当フィールドに具体的なエラーメッセージが表示される SHALL

### 要件 10: ログ管理

**ユーザーストーリー:** システム管理者として、アプリケーションの動作ログを確認したいので、問題の調査と監視ができるようになりたい

#### 受け入れ基準

1. WHEN 重要な操作（CRUD操作）が実行される THEN INFO レベルでログが記録される SHALL
2. WHEN エラーが発生する THEN ERROR レベルでスタックトレースを含むログが記録される SHALL
3. WHEN デバッグモードが有効な場合 THEN SQLクエリがコンソールに出力される SHALL
4. WHEN ログファイルのサイズが10MBを超える THEN 自動的にローテーションされる SHALL

### 要件 11: 開発環境セットアップ

**ユーザーストーリー:** 開発者として、簡単に開発環境をセットアップしたいので、素早く開発を開始できるようになりたい

#### 受け入れ基準

1. WHEN Maven または Gradle でプロジェクトをビルドする THEN すべての依存関係が自動的に解決される SHALL
2. WHEN spring-boot:run コマンドを実行する THEN アプリケーションが http://localhost:8080 で起動する SHALL
3. WHEN H2コンソールにアクセスする THEN http://localhost:8080/h2-console でデータベースの内容を確認できる SHALL
4. WHEN application.properties を設定する THEN 開発環境用の設定が適用される SHALL

### 要件 12: テスト環境

**ユーザーストーリー:** 開発者として、自動テストを実行したいので、品質を維持できるようになりたい

#### 受け入れ基準

1. WHEN mvn test を実行する THEN すべての単体テストが実行される SHALL
2. WHEN @SpringBootTest アノテーションを使用する THEN 統合テストが実行される SHALL
3. WHEN テスト実行時 THEN インメモリH2データベースが使用される SHALL
4. WHEN MockMvc を使用する THEN REST APIのテストが実行できる SHALL

## 技術仕様

### 使用技術スタック

- **フレームワーク**: Spring Boot 3.x
- **言語**: Java 17以上
- **ビルドツール**: Maven または Gradle
- **データベース**: H2 Database (組み込みモード)
- **ORM**: Spring Data JPA / Hibernate
- **Webフレームワーク**: Spring MVC
- **テンプレートエンジン**: Thymeleaf
- **API仕様**: RESTful API (JSON)
- **ロギング**: SLF4J + Logback
- **テスト**: JUnit 5, Mockito, Spring Boot Test

### データモデル

```
Todo エンティティ:
- id: Long (Primary Key, Auto-generated)
- title: String (必須, 最大100文字)
- description: String (任意, 最大500文字)
- status: Enum (TODO, IN_PROGRESS, DONE)
- priority: Enum (LOW, MEDIUM, HIGH)
- dueDate: LocalDate (任意)
- createdAt: LocalDateTime (自動設定)
- updatedAt: LocalDateTime (自動更新)
```

### API エンドポイント

```
GET    /api/todos          - Todo一覧取得
GET    /api/todos/{id}     - Todo詳細取得
POST   /api/todos          - Todo作成
PUT    /api/todos/{id}     - Todo更新
DELETE /api/todos/{id}     - Todo削除
GET    /api/todos/search   - Todo検索
```

### 画面構成

```
/                     - ホーム画面（一覧画面へリダイレクト）
/todos                - Todo一覧画面
/todos/new            - Todo作成画面
/todos/{id}           - Todo詳細画面
/todos/{id}/edit      - Todo編集画面
/todos/search         - Todo検索画面
```

## 非機能要件

### パフォーマンス要件

- 一覧表示: 1000件のTodoを1秒以内に表示
- API応答時間: 平均200ms以内
- 同時接続数: 最大100ユーザー

### セキュリティ要件

- SQLインジェクション対策: JPA/Hibernateのパラメータバインディング使用
- XSS対策: Thymeleafの自動エスケープ機能使用
- CSRF対策: Spring Securityのデフォルト設定使用（簡易版では無効化も可）

### 可用性要件

- アプリケーション起動時間: 30秒以内
- H2データベースの自動バックアップ: 任意（本番環境では推奨）

## 制約事項

1. **簡易実装**: 認証・認可機能は実装しない（将来的な拡張は可能）
2. **組み込みDB**: H2データベースを使用し、外部データベースサーバーは不要
3. **単一インスタンス**: スケールアウトは考慮しない
4. **ローカル実行**: Docker化は任意、基本的にはローカル環境での実行を想定
5. **UI**: 基本的なHTML/CSSで実装、高度なJavaScriptフレームワークは使用しない