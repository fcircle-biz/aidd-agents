# 要件文書

## 概要

Java Spring Bootを使用したTODOリストの管理を効率化するWebアプリケーションです。JPA/Hibernateによるデータ永続化、H2 Databaseによる開発環境での高速開発、Thymeleafテンプレートエンジンによる動的なHTML生成を実現し、エンドユーザーが効率的にタスク管理を行える価値を提供します。

## 要件

### 要件 1: TODO作成

**ユーザーストーリー:** エンドユーザーとして、新しいタスクを記録したいので、TODOアイテムを作成して管理できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが新規作成フォームにタイトル（必須、最大100文字）と説明（任意、最大500文字）を入力して送信ボタンをクリック THEN 新しいTODOアイテムがデータベースに保存され、一覧画面にリダイレクト SHALL
2. WHEN ユーザーがタイトルを入力せずに送信ボタンをクリック THEN 「タイトルは必須項目です」というエラーメッセージが表示され、フォームに留まる SHALL
3. IF タイトルが100文字を超える、または説明が500文字を超える THEN 「文字数制限を超えています」というバリデーションエラーが表示される SHALL
4. WHEN TODOアイテムの作成が成功 THEN 「TODOを作成しました」という成功メッセージが表示され、作成日時が自動的に記録される SHALL

### 要件 2: TODO一覧表示

**ユーザーストーリー:** エンドユーザーとして、すべてのタスクを俯瞰したいので、登録されているTODOアイテムの一覧を確認できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーがアプリケーションのホームページ（/）にアクセス THEN すべてのTODOアイテムがテーブル形式（ID、タイトル、完了状態、作成日時、操作ボタン）で表示される SHALL
2. WHEN TODOアイテムが存在しない THEN 「TODOアイテムがありません」というメッセージと新規作成ボタンが表示される SHALL
3. WHEN 一覧画面を表示 THEN 各TODOアイテムに「編集」「削除」「完了/未完了切り替え」のアクションボタンが表示される SHALL
4. WHEN TODOアイテムが10件以上存在する THEN 作成日時の降順（新しいものが上）でソートされて表示される SHALL

### 要件 3: TODO編集

**ユーザーストーリー:** エンドユーザーとして、タスクの内容を更新したいので、既存のTODOアイテムを編集できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面で特定のTODOアイテムの「編集」ボタンをクリック THEN 編集フォーム（/todos/{id}/edit）が表示され、現在の値がプリフィルされる SHALL
2. WHEN ユーザーが編集フォームでタイトルまたは説明を変更して「更新」ボタンをクリック THEN 変更内容がデータベースに保存され、更新日時が記録される SHALL
3. IF 編集時にタイトルを空にして送信 THEN 「タイトルは必須項目です」というエラーメッセージが表示される SHALL
4. WHEN 更新が成功 THEN 「TODOを更新しました」という成功メッセージが表示され、一覧画面にリダイレクトされる SHALL
5. IF 存在しないIDで編集画面にアクセス THEN 404エラーページが表示される SHALL

### 要件 4: TODO削除

**ユーザーストーリー:** エンドユーザーとして、不要になったタスクを整理したいので、TODOアイテムを削除できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面で特定のTODOアイテムの「削除」ボタンをクリック THEN 「本当に削除しますか？」という確認ダイアログが表示される SHALL
2. WHEN ユーザーが確認ダイアログで「はい」を選択 THEN 該当のTODOアイテムがデータベースから物理削除される SHALL
3. WHEN 削除が成功 THEN 「TODOを削除しました」という成功メッセージが表示され、一覧画面が更新される SHALL
4. IF 削除処理中にエラーが発生 THEN 「削除に失敗しました」というエラーメッセージが表示され、TODOアイテムは削除されない SHALL

### 要件 5: TODO完了状態切り替え

**ユーザーストーリー:** エンドユーザーとして、タスクの進捗を管理したいので、TODOアイテムの完了/未完了状態を切り替えられるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面で未完了のTODOアイテムの「完了にする」ボタンをクリック THEN 該当アイテムのステータスが「完了」に更新される SHALL
2. WHEN ユーザーが一覧画面で完了済みのTODOアイテムの「未完了に戻す」ボタンをクリック THEN 該当アイテムのステータスが「未完了」に更新される SHALL
3. WHEN 完了状態が変更される THEN 完了日時または未完了日時が自動的に記録される SHALL
4. WHEN 一覧画面を表示 THEN 完了済みのTODOアイテムは視覚的に区別できる（取り消し線、グレーアウトなど）表示となる SHALL

### 要件 6: データ永続化

**ユーザーストーリー:** システムとして、データの永続性を確保したいので、TODOアイテムがデータベースに適切に保存・管理されるようになりたい

#### 受け入れ基準

1. WHEN アプリケーションが起動 THEN H2 Databaseが自動的に初期化され、TODOテーブル（id、title、description、completed、created_at、updated_at）が作成される SHALL
2. WHEN データベース操作が実行される THEN JPA/Hibernateを通じてエンティティマッピングが適用される SHALL
3. IF データベース接続エラーが発生 THEN エラーログが記録され、ユーザーにはフレンドリーなエラーメッセージが表示される SHALL
4. WHEN 開発環境でアプリケーションを実行 THEN H2コンソール（/h2-console）にアクセスしてデータベースの内容を確認できる SHALL

### 要件 7: エラーハンドリング

**ユーザーストーリー:** エンドユーザーとして、エラーが発生しても安心して使用したいので、適切なエラーメッセージとリカバリー方法が提示されるようになりたい

#### 受け入れ基準

1. WHEN 400番台のHTTPエラーが発生 THEN カスタムエラーページが表示され、ホームへ戻るリンクが提供される SHALL
2. WHEN 500番台のサーバーエラーが発生 THEN 「一時的な問題が発生しました」というメッセージと共に、エラーIDがログに記録される SHALL
3. WHEN バリデーションエラーが発生 THEN 該当フィールドの近くに具体的なエラーメッセージが表示される SHALL
4. IF データベース接続タイムアウトが発生 THEN リトライ処理が3回まで実行され、それでも失敗した場合はメンテナンス画面が表示される SHALL

### 要件 8: ユーザーインターフェース

**ユーザーストーリー:** エンドユーザーとして、直感的に操作したいので、見やすく使いやすいUIで操作できるようになりたい

#### 受け入れ基準

1. WHEN ユーザーが画面を表示 THEN ThymeleafテンプレートによりレスポンシブデザインのHTMLが生成される SHALL
2. WHEN フォームが表示される THEN Bootstrap 5またはそれに準ずるCSSフレームワークによりスタイリングされる SHALL
3. WHEN 操作が成功または失敗 THEN フラッシュメッセージ（成功は緑、エラーは赤）が画面上部に3秒間表示される SHALL
4. WHEN モバイルデバイスでアクセス THEN 画面幅に応じてレイアウトが最適化される SHALL

### 要件 9: 開発環境セットアップ

**ユーザーストーリー:** 開発者として、すぐに開発を開始したいので、簡単にローカル環境をセットアップできるようになりたい

#### 受け入れ基準

1. WHEN 開発者がプロジェクトをクローン THEN README.mdに記載された手順に従ってセットアップできる SHALL
2. WHEN `./mvnw spring-boot:run`または`./gradlew bootRun`を実行 THEN アプリケーションがlocalhost:8080で起動する SHALL
3. WHEN application.propertiesまたはapplication.ymlを編集 THEN データベース設定、ポート番号、ログレベルを変更できる SHALL
4. WHEN 開発モードで実行 THEN ホットリロード機能（Spring Boot DevTools）が有効になる SHALL

### 要件 10: ログ出力

**ユーザーストーリー:** システム管理者として、問題を迅速に特定したいので、適切なログが記録されるようになりたい

#### 受け入れ基準

1. WHEN アプリケーションが動作 THEN INFO、WARN、ERRORレベルのログがコンソールとファイル（logs/application.log）に出力される SHALL
2. WHEN CRUD操作が実行される THEN 操作種別、対象ID、実行時刻、実行結果がINFOレベルで記録される SHALL
3. WHEN エラーが発生 THEN スタックトレース、リクエストパラメータ、セッションIDがERRORレベルで記録される SHALL
4. IF ログファイルが10MBを超える THEN 自動的にローテーションされ、最大10世代まで保持される SHALL