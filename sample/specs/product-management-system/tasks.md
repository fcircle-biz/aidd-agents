# 実装計画

- [x] 1. プロジェクト構造とコア設定の作成

  - プロジェクトディレクトリ構造を作成し、必要なパッケージの初期化ファイルを配置
  - requirements.txtファイルを作成してStreamlit、SQLModel、Pandasなどの依存関係を定義
  - README.mdファイルを作成してセットアップ手順と使用方法を記載
  - _要件: 7.1, 7.4_

- [x] 2. データモデルとデータベース基盤の実装
  - [x] 2.1 商品データモデルの作成
    - SQLModelを使用してProductクラスを実装し、必要なフィールドとバリデーションを定義
    - 商品名、価格、カテゴリ、在庫数、説明、作成日時、更新日時のフィールドを含める
    - _要件: 6.1, 6.3_
  
  - [x] 2.2 データベース接続ユーティリティの実装
    - SQLiteデータベース接続を管理するdatabase.pyユーティリティを作成
    - データベースエンジンの作成とテーブル初期化機能を実装
    - _要件: 6.2, 6.3_

- [x] 3. データアクセス層の実装
  - [x] 3.1 商品リポジトリの基本CRUD操作実装
    - ProductRepositoryクラスを作成し、create、get_by_id、get_all、update、deleteメソッドを実装
    - SQLModelのSessionを使用したデータベース操作を実装
    - _要件: 6.1, 6.4_
  
  - [x] 3.2 検索・フィルタリング機能の実装
    - search_by_name、filter_by_category、filter_by_price_rangeメソッドを実装
    - 部分一致検索とフィルタリングロジックを実装
    - _要件: 3.1, 3.2, 3.3_

- [x] 4. ビジネスロジック層の実装
  - [x] 4.1 バリデーション機能の実装
    - validators.pyファイルを作成し、商品データのバリデーション関数を実装
    - 必須フィールドチェック、数値範囲チェック、文字列長チェックを実装
    - _要件: 1.3, 4.4_
  
  - [x] 4.2 商品サービスクラスの実装
    - ProductServiceクラスを作成し、ビジネスロジックを実装
    - create_product、get_product、update_product、delete_productメソッドを実装
    - バリデーション機能とリポジトリを統合
    - _要件: 1.2, 4.3, 5.2_

- [x] 5. エラーハンドリングの実装
  - [x] 5.1 エラーハンドリング用のデコレータとユーティリティ関数を実装
    - utils/error_handler.pyに統合的なエラー管理システムを実装
    - ApplicationError、DatabaseError、ValidationError、NotFoundErrorクラスを実装
    - エラーロガー、デコレータ、コンテキストマネージャーを実装
    - _要件: 6.4_
  - [x] 5.2 データベースエラー、バリデーションエラー、システムエラーの適切な処理を実装
    - ProductServiceの全メソッドに統合されたエラーハンドリングを適用
    - services/validators.pyを新しいエラーシステムと統合
    - _要件: 1.3, 4.4_
  - [x] 5.3 Streamlitでのユーザーフレンドリーなエラーメッセージ表示機能を実装
    - utils/streamlit_helpers.pyにStreamlit用エラーハンドリングヘルパーを実装
    - エラータイプ別の表示形式、フォームハンドラー、確認ダイアログ機能を実装
    - デバッグモード機能とエラー境界コンテキストマネージャーを実装
    - _要件: 6.4, 1.3, 4.4_

- [x] 6. 商品登録機能の実装
  - [x] 6.1 商品登録フォームの作成
    - pages/product_form.pyファイルを作成し、商品登録用のStreamlitフォームを実装
    - 商品名、価格、カテゴリ、在庫数、説明の入力フィールドを配置
    - フォーム入力バリデーション、使用方法ヒント、入力内容確認機能を実装
    - _要件: 1.1_
  
  - [x] 6.2 商品登録処理の統合
    - フォーム送信時の処理ロジックを実装し、サービス層と連携
    - 成功・エラーメッセージの表示機能を実装  
    - エラーハンドリング統合、登録商品情報表示、次のアクション提案機能を実装
    - 統合テスト（test_product_form.py）でデータベース接続とサービス層の動作を確認
    - _要件: 1.2, 1.4_

- [x] 7. 商品一覧表示機能の実装
  - [x] 7.1 商品一覧ページの作成
    - pages/product_list.pyファイルを作成し、商品一覧をテーブル形式で表示
    - 商品名、価格、カテゴリ、在庫数、登録日を含むテーブルを実装
    - セッション状態管理によるページ状態保持機能を実装
    - _要件: 2.1, 2.2_
  
  - [x] 7.2 ページネーション機能の実装
    - 大量データに対応するページネーション機能を実装
    - ページ切り替え（最初、前へ、次へ、最後）とページ選択機能を実装
    - ページサイズ設定機能（5、10、20、50、100件）を実装
    - データ取得の最適化を実装
    - _要件: 2.4_
  
  - [x] 7.3 空データ状態の処理
    - 商品が登録されていない場合の適切なメッセージ表示を実装
    - 商品登録ページへの案内機能を実装
    - _要件: 2.3_
  
  - [x] 7.4 ソート機能とその他の機能実装
    - 商品名、価格、カテゴリ、在庫数、登録日、更新日でのソート機能を実装
    - 昇順・降順の切り替え機能を実装
    - 商品統計情報表示機能（総商品数、在庫総額、カテゴリ数、在庫少商品数）を実装
    - データリフレッシュ機能を実装
    - 包括的なテストケース（tests/test_product_list.py）を作成

- [ ] 8. 商品検索・フィルタリング機能の実装
  - [ ] 8.1 検索インターフェースの作成
    - pages/product_search.pyファイルを作成し、検索フォームを実装
    - 商品名検索ボックス、カテゴリフィルター、価格範囲フィルターを配置
    - _要件: 3.1, 3.2, 3.3_
  
  - [ ] 8.2 検索結果表示の実装
    - 検索条件に基づく商品一覧の表示機能を実装
    - 検索結果が見つからない場合のメッセージ表示を実装
    - _要件: 3.4_

- [ ] 9. 商品編集機能の実装
  - [ ] 9.1 商品編集フォームの作成
    - 既存商品データを事前入力した編集フォームを実装
    - 商品一覧からの編集ボタン連携を実装
    - _要件: 4.1, 4.2_
  
  - [ ] 9.2 商品更新処理の実装
    - 編集フォーム送信時の更新処理を実装
    - バリデーションとエラーハンドリングを統合
    - _要件: 4.3, 4.4_

- [ ] 10. 商品削除機能の実装
  - [ ] 10.1 削除確認ダイアログの実装
    - Streamlitを使用した削除確認ダイアログを実装
    - 商品一覧からの削除ボタン連携を実装
    - _要件: 5.1_
  
  - [ ] 10.2 商品削除処理の実装
    - 削除確認後の商品削除処理を実装
    - 削除成功メッセージと一覧更新機能を実装
    - キャンセル処理の実装
    - _要件: 5.2, 5.3, 5.4_

- [ ] 11. メインアプリケーションの統合
  - [ ] 11.1 ナビゲーション機能の実装
    - app.pyファイルを作成し、Streamlitのサイドバーナビゲーションを実装
    - 各ページ（一覧、登録、検索）への遷移機能を実装
  
  - [ ] 11.2 セッション状態管理の実装
    - Streamlitのセッション状態を使用したデータ管理を実装
    - ページ間でのデータ共有とキャッシュ機能を実装

- [ ] 12. テストの実装
  - [ ] 12.1 単体テストの作成
    - pytestを使用してモデル、リポジトリ、サービスの単体テストを作成
    - テストフィクスチャとモックデータの作成
  
  - [ ] 12.2 統合テストの作成
    - データベース操作を含む統合テストを作成
    - エンドツーエンドのデータフロー検証テストを作成

- [ ] 13. 最終統合とテスト
  - 全機能の統合テストを実行し、要件との適合性を検証
  - パフォーマンステストとエラーハンドリングの検証を実行
  - ドキュメントの最終更新と使用方法の確認